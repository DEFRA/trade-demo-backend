server:
  port: ${PORT:8085}
  shutdown: graceful

spring:
  application:
    name: trade-demo-backend
  data:
    mongodb:
      uri: ${MONGO_URI:mongodb://localhost:27017/}
      database: ${MONGO_DATABASE:trade-demo-backend}
      auto-index-creation: true
      read-preference: ${MONGO_READ_PREFERENCE:secondary}
      write-concern: ${MONGO_WRITE_CONCERN:majority}
      connection-pool:
        min-size: ${MONGO_POOL_MIN_SIZE:10}
        max-size: ${MONGO_POOL_MAX_SIZE:100}
        max-wait-time-ms: ${MONGO_POOL_MAX_WAIT_TIME_MS:2000}
        max-connection-idle-time-ms: ${MONGO_POOL_MAX_IDLE_TIME_MS:60000}
      ssl:
        enabled: true
  lifecycle:
    timeout-per-shutdown-phase: 30s


# CDP platform configuration
cdp:
  certificate: ${TRUSTSTORE_CDP_ROOT_CA:}
  metrics:
    enabled: true
  service-version: ${SERVICE_VERSION:0.0.0-local}
  tracing:
    header-name: ${TRACING_HEADER:x-cdp-request-id}
  cloudwatch:
    endpoint: ${AWS_EMF_AGENT_ENDPOINT:http://localhost:4566}
  proxyUrl: ${HTTP_PROXY:}
  
# ipaffs configuration
ipaffs:
  api:
    baseUrl: ${IPAFFS_API_BASE_URL:https://importnotification-api-static-snd.azure.defra.cloud}
    relativePath: /notificationapi/snd/protected/notifications
  
# Trade auth api configuration
trade-auth:
  api:
    url: ${TRADE_PLATFORM_AUTH_URL:http://localhost:3002/tenant/oauth2/v2.0/token}
  client-id: ${TRADE_PLATFORM_CLIENT_ID:test}
  client-secret: ${TRADE_PLATFORM_CLIENT_SECRET:test_value}
  scope: ${TRADE_PLATFORM_SCOPE:default}
  connectionTimeout: 3000
  readTimeout: 3000
  
# MDM api configuration
mdm-service:
  url: ${MDM_SERVICE_URL:http://localhost:4065}
  ocpApimSubscriptionKey: ${TRADE_PLATFORM_SUBSCRIPTION_KEY:test}
  connectionTimeout: 3000
  readTimeout: 3000

# AWS configuration
aws:
  region: ${AWS_REGION:eu-west-2}
  sts:
    token:
      audience: ${STS_TOKEN_AUDIENCE:urn:ipaffs:api:dev}
      expiration: ${STS_TOKEN_DURATION_SECONDS:3600}
  emf:
    enabled: ${AWS_EMF_ENABLED:true}
    environment: ${AWS_EMF_ENVIRONMENT:Local}
    namespace: ${AWS_EMF_NAMESPACE:trade-demo-backend}
    service:
      name: ${AWS_EMF_SERVICE_NAME:trade-demo-backend}
      type: ${AWS_EMF_SERVICE_TYPE:SpringBootApp}

# Logging configuration
logging:
  level:
    root: ${LOG_LEVEL:INFO}
    uk.gov.defra.cdp.trade.demo: ${LOG_LEVEL:DEBUG}
    uk.gov.defra.cdp.trade.demo.common.metrics: ${LOGGING_LEVEL_UK_GOV_DEFRA_CDP_TRADE_DEMO_COMMON_METRICS:INFO}
    org.springframework: ${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK:INFO}
    org.springframework.web: ${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB:INFO}
    org.mongodb: ${LOGGING_LEVEL_ORG_MONGODB_DRIVER:WARN}
    io.netty.handler.logging.LoggingHandler: WARN

# Actuator endpoints
# Production: Only health endpoint exposed (secure by default)
# Development: Use dev profile (application-dev.yml) for debugging endpoints
management:
  endpoints:
    web:
      base-path: /
      exposure:
        include: health,metrics,info, cache
  endpoint:
    health:
      show-details: never
  info:
    env:
      enabled: true
  health:
    mongo:
      enabled: false
  metrics:
    enabled: ${METRICS_ENABLED:false}
  
# Application info (exposed via /info endpoint)
info:
  app:
    name: ${spring.application.name}
    version: ${cdp.service-version}
    environment: ${ENVIRONMENT:local}
